# Fuzz Coverage Script

This repository includes a helper script, `fuzz_coverage.sh`, that lets you generate local coverage reports for our fuzz targets.

The script is meant to be copied into the **root of the [stratum](https://github.com/stratum-mining/stratum) repository**.

It also expects that the **corpus directory** of this repository to be present in `fuzz/corpus` on the [stratum](https://github.com/stratum-mining/stratum) repository.

---

## Requirements

Before running the script, the following must be available directly in your `$PATH`:

* `llvm-profdata`
* `llvm-cov`
* A nightly Rust toolchain
* `cargo-fuzz`

For details on installing LLVM coverage tools, see:
[https://doc.rust-lang.org/rustc/instrument-coverage.html#installing-llvm-coverage-tools](https://doc.rust-lang.org/rustc/instrument-coverage.html#installing-llvm-coverage-tools)

---

## Expected Project Layout

After copying `fuzz_coverage.sh` into the root of [stratum](https://github.com/stratum-mining/stratum) repository, the structure should look like:

```
stratum/
├── coverage_html        (generated by the fuzz_coverage.sh after a successfull run)
├── fuzz
│   ├── artifacts
│   ├── corpus           (the one copied from this repo)
│   ├── coverage         (generated by cargo-fuzz)
│   ├── fuzz_targets
└── fuzz_coverage.sh     (copied from this repo to the root of the stratum repo)
```

---

## Usage

Run the script from the project root:

```bash
./fuzz_coverage.sh
```

The script does the following:

1. Runs `cargo +nightly fuzz coverage` for every fuzz target.
2. Merges all generated `.profdata` files.
3. Collects the built coverage binaries.
5. Generates:
   * `coverage_summary.txt` (text report)
   * `coverage_html/` (HTML report)

---

## Output

After running:

* Open the HTML report:

  ```
  coverage_html/index.html
  ```

* View the text summary:

  ```
  coverage_summary.txt
  ```
